# å¥åº·ç®¡ç†ç³»ç»Ÿ - æœåŠ¡å™¨éƒ¨ç½²è¯´æ˜

## ğŸ“¦ å·²åˆ›å»ºçš„éƒ¨ç½²æ–‡ä»¶

æˆ‘å·²ç»ä¸ºä½ åˆ›å»ºäº†å®Œæ•´çš„ Docker å®¹å™¨åŒ–éƒ¨ç½²æ–¹æ¡ˆï¼Œä»¥ä¸‹æ˜¯æ‰€æœ‰ç›¸å…³æ–‡ä»¶ï¼š

### æ ¸å¿ƒéƒ¨ç½²æ–‡ä»¶

```
healthManagement/
â”œâ”€â”€ docker-compose.yml          # Docker ç¼–æ’é…ç½®
â”œâ”€â”€ deploy.sh                   # ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆæ¨èä½¿ç”¨ï¼‰
â”œâ”€â”€ env.example                 # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ .dockerignore              # Docker æ„å»ºå¿½ç•¥æ–‡ä»¶
â”‚
â”œâ”€â”€ ai-service/
â”‚   â””â”€â”€ Dockerfile             # AI æœåŠ¡å®¹å™¨é…ç½®
â”‚
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ Dockerfile             # åç«¯æœåŠ¡å®¹å™¨é…ç½®
â”‚   â””â”€â”€ src/main/resources/
â”‚       â””â”€â”€ application-prod.yml  # ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ Dockerfile             # å‰ç«¯æœåŠ¡å®¹å™¨é…ç½®
â”‚   â””â”€â”€ nginx.conf             # Nginx é…ç½®
â”‚
â””â”€â”€ scripts/
    â”œâ”€â”€ backup.sh              # æ•°æ®å¤‡ä»½è„šæœ¬
    â”œâ”€â”€ restore.sh             # æ•°æ®æ¢å¤è„šæœ¬
    â””â”€â”€ health-check.sh        # å¥åº·æ£€æŸ¥è„šæœ¬
```

### æ–‡æ¡£æ–‡ä»¶

- **DEPLOYMENT.md** - è¯¦ç»†éƒ¨ç½²æ–‡æ¡£ï¼ˆåŒ…å«æ•…éšœæ’é™¤ï¼‰
- **QUICK_START.md** - 5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²æŒ‡å—
- **éƒ¨ç½²è¯´æ˜.md** - æœ¬æ–‡æ¡£ï¼ˆä¸­æ–‡è¯´æ˜ï¼‰

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æœåŠ¡å™¨ç¯å¢ƒ

**æœåŠ¡å™¨è¦æ±‚ï¼š**
- æ“ä½œç³»ç»Ÿï¼šLinux (Ubuntu 20.04+ æˆ– CentOS 7+)
- å†…å­˜ï¼šè‡³å°‘ 4GB RAM
- ç£ç›˜ï¼šè‡³å°‘ 20GB
- ç«¯å£ï¼šéœ€å¼€æ”¾ 80ã€8081ã€8001

**å®‰è£… Docker (Ubuntu)ï¼š**

```bash
# å®‰è£… Docker
curl -fsSL https://get.docker.com | sh

# å¯åŠ¨ Docker
sudo systemctl start docker
sudo systemctl enable docker

# å®‰è£… Docker Compose
sudo apt-get install docker-compose-plugin

# éªŒè¯å®‰è£…
docker --version
docker compose version
```

### ç¬¬äºŒæ­¥ï¼šä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨

**æ–¹å¼ä¸€ï¼šä½¿ç”¨ Gitï¼ˆæ¨èï¼‰**

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /opt
git clone <ä½ çš„ä»“åº“åœ°å€> health-management
cd health-management
```

**æ–¹å¼äºŒï¼šä½¿ç”¨ SCP ä¸Šä¼ **

```bash
# åœ¨æœ¬åœ°æ‰§è¡Œ
cd /Users/liuzixuan/
tar -czf healthManagement.tar.gz healthManagement/
scp healthManagement.tar.gz root@ä½ çš„æœåŠ¡å™¨IP:/opt/

# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /opt
tar -xzf healthManagement.tar.gz
cd healthManagement
```

### ç¬¬ä¸‰æ­¥ï¼šé…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp env.example .env

# ç¼–è¾‘é…ç½®
vi .env
```

**ä¿®æ”¹ä»¥ä¸‹å†…å®¹ï¼š**

```bash
# é€šä¹‰åƒé—® API Keyï¼ˆå¿…å¡«ï¼‰
DASHSCOPE_API_KEY=sk-ä½ çš„APIå¯†é’¥

# é˜¿é‡Œäº‘ OSS é…ç½®ï¼ˆå¿…å¡«ï¼‰
ALIYUN_OSS_ACCESS_KEY_ID=ä½ çš„AccessKeyId
ALIYUN_OSS_ACCESS_KEY_SECRET=ä½ çš„AccessKeySecret
```

> ğŸ’¡ **è·å– API Keyï¼š**
> - é€šä¹‰åƒé—®ï¼šhttps://dashscope.console.aliyun.com/
> - é˜¿é‡Œäº‘ OSSï¼šhttps://ram.console.aliyun.com/

### ç¬¬å››æ­¥ï¼šæ‰§è¡Œéƒ¨ç½²

```bash
# èµ‹äºˆæ‰§è¡Œæƒé™
chmod +x deploy.sh

# è¿è¡Œéƒ¨ç½²è„šæœ¬
./deploy.sh
```

**é€‰æ‹© "1 - å…¨æ–°éƒ¨ç½²"**

è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š
1. âœ… æ£€æŸ¥ Docker ç¯å¢ƒ
2. âœ… æ„å»ºä¸‰ä¸ªæœåŠ¡çš„é•œåƒ
3. âœ… å¯åŠ¨æ‰€æœ‰å®¹å™¨
4. âœ… æ‰§è¡Œå¥åº·æ£€æŸ¥

### ç¬¬äº”æ­¥ï¼šéªŒè¯éƒ¨ç½²

ç­‰å¾… 2-3 åˆ†é’Ÿåï¼Œåœ¨æµè§ˆå™¨è®¿é—®ï¼š

```
http://ä½ çš„æœåŠ¡å™¨IP
```

ä½ åº”è¯¥èƒ½çœ‹åˆ°å¥åº·ç®¡ç†ç³»ç»Ÿçš„ç™»å½•é¡µé¢ï¼

---

## ğŸ¯ æœåŠ¡è®¿é—®åœ°å€

éƒ¨ç½²æˆåŠŸåï¼Œå¯ä»¥è®¿é—®ï¼š

| æœåŠ¡ | åœ°å€ | è¯´æ˜ |
|------|------|------|
| å‰ç«¯åº”ç”¨ | http://æœåŠ¡å™¨IP | ä¸»è¦è®¿é—®å…¥å£ |
| åç«¯ API | http://æœåŠ¡å™¨IP:8081 | REST API |
| AI æœåŠ¡ | http://æœåŠ¡å™¨IP:8001 | AI æ™ºèƒ½ä½“ |

---

## ğŸ“Š æœåŠ¡ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æ‰€æœ‰å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
docker stats

# è¿è¡Œå¥åº·æ£€æŸ¥è„šæœ¬
./scripts/health-check.sh
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—ï¼ˆå®æ—¶ï¼‰
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f backend     # åç«¯
docker-compose logs -f ai-service  # AIæœåŠ¡
docker-compose logs -f frontend    # å‰ç«¯

# æŸ¥çœ‹æœ€è¿‘100è¡Œæ—¥å¿—
docker-compose logs --tail=100 backend
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
docker-compose restart

# é‡å¯å•ä¸ªæœåŠ¡
docker-compose restart backend
```

### åœæ­¢æœåŠ¡

```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose stop

# å®Œå…¨åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker-compose down
```

### æ›´æ–°æœåŠ¡

```bash
# ä»£ç æ›´æ–°åé‡æ–°éƒ¨ç½²
git pull                          # æ‹‰å–æœ€æ–°ä»£ç 
docker-compose up -d --build      # é‡æ–°æ„å»ºå¹¶å¯åŠ¨

# æˆ–ä½¿ç”¨éƒ¨ç½²è„šæœ¬
./deploy.sh  # é€‰æ‹©é€‰é¡¹ 3 - æ›´æ–°å¹¶é‡å¯
```

---

## ğŸ”§ è¿ç»´è„šæœ¬

### æ•°æ®å¤‡ä»½

```bash
# æ‰§è¡Œæ•°æ®å¤‡ä»½ï¼ˆæ•°æ®åº“ + ä¸Šä¼ æ–‡ä»¶ï¼‰
./scripts/backup.sh

# å¤‡ä»½æ–‡ä»¶ä¿å­˜åœ¨ ./backups/ ç›®å½•
# æ ¼å¼ï¼šdb_backup_YYYYMMDD_HHMMSS.dump
```

### æ•°æ®æ¢å¤

```bash
# æ¢å¤æ•°æ®åº“
./scripts/restore.sh ./backups/db_backup_20241223_120000.dump

# æ¢å¤æ•°æ®åº“å’Œæ–‡ä»¶
./scripts/restore.sh \
  ./backups/db_backup_20241223_120000.dump \
  ./backups/uploads_20241223_120000.tar.gz
```

### å¥åº·æ£€æŸ¥

```bash
# è¿è¡Œå®Œæ•´çš„å¥åº·æ£€æŸ¥
./scripts/health-check.sh

# æ£€æŸ¥å†…å®¹ï¼š
# - Docker å®¹å™¨çŠ¶æ€
# - æœåŠ¡ç«¯ç‚¹å¥åº·
# - ç³»ç»Ÿèµ„æºä½¿ç”¨
# - Docker å®¹å™¨èµ„æº
```

---

## ğŸ”¥ å¸¸è§é—®é¢˜è§£å†³

### 1. ç«¯å£è¢«å ç”¨

**é—®é¢˜ï¼š** å¯åŠ¨å¤±è´¥ï¼Œæç¤ºç«¯å£å·²è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo lsof -i :80
sudo lsof -i :8081

# æ–¹å¼ä¸€ï¼šåœæ­¢å ç”¨è¿›ç¨‹
sudo kill -9 <PID>

# æ–¹å¼äºŒï¼šä¿®æ”¹ç«¯å£ï¼ˆç¼–è¾‘ docker-compose.ymlï¼‰
vi docker-compose.yml
# ä¿®æ”¹ ports é…ç½®ï¼Œå¦‚ "8080:80"
```

### 2. æœåŠ¡æ— æ³•å¯åŠ¨

**é—®é¢˜ï¼š** å®¹å™¨å¯åŠ¨åç«‹å³é€€å‡º

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs backend

# å¸¸è§åŸå› ï¼š
# - ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯ï¼ˆæ£€æŸ¥ .env æ–‡ä»¶ï¼‰
# - æ•°æ®åº“è¿æ¥å¤±è´¥ï¼ˆæ£€æŸ¥æ•°æ®åº“åœ°å€å’Œç«¯å£ï¼‰
# - API Key æ— æ•ˆï¼ˆæ£€æŸ¥é€šä¹‰åƒé—® API Keyï¼‰
```

### 3. æ— æ³•è®¿é—®æœåŠ¡

**é—®é¢˜ï¼š** æµè§ˆå™¨æ— æ³•è®¿é—® http://æœåŠ¡å™¨IP

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# 1. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status                    # Ubuntu
sudo firewall-cmd --list-ports     # CentOS

# 2. å¼€æ”¾ç«¯å£
sudo ufw allow 80                  # Ubuntu
sudo firewall-cmd --add-port=80/tcp --permanent  # CentOS
sudo firewall-cmd --reload         # CentOS

# 3. æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œ
docker-compose ps

# 4. æ£€æŸ¥æœåŠ¡å¥åº·
curl http://localhost/health
```

### 4. æ•°æ®åº“è¿æ¥å¤±è´¥

**é—®é¢˜ï¼š** åç«¯æœåŠ¡æ—¥å¿—æ˜¾ç¤ºæ•°æ®åº“è¿æ¥é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# 1. æµ‹è¯•æ•°æ®åº“è¿æ¥
docker-compose exec backend bash
apt-get update && apt-get install -y postgresql-client
psql -h 47.94.41.55 -U health_user -d health_db

# 2. æ£€æŸ¥æ•°æ®åº“é…ç½®
cat backend/src/main/resources/application-prod.yml

# 3. ç¡®ä¿æœåŠ¡å™¨å¯ä»¥è®¿é—®æ•°æ®åº“ï¼ˆæ£€æŸ¥ç½‘ç»œå’Œå®‰å…¨ç»„ï¼‰
telnet 47.94.41.55 5432
```

### 5. AI æœåŠ¡è°ƒç”¨å¤±è´¥

**é—®é¢˜ï¼š** èŠå¤©åŠŸèƒ½æ— æ³•ä½¿ç”¨

**è§£å†³æ–¹æ¡ˆï¼š**

```bash
# 1. æ£€æŸ¥ AI æœåŠ¡çŠ¶æ€
docker-compose logs ai-service

# 2. éªŒè¯ API Key
docker-compose exec ai-service env | grep DASHSCOPE

# 3. æµ‹è¯• AI æœåŠ¡
curl http://localhost:8001/health
```

---

## ğŸ”’ å®‰å…¨å»ºè®®

### ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®

1. **ä¿®æ”¹æ•°æ®åº“å¯†ç **

ç¼–è¾‘ `backend/src/main/resources/application-prod.yml`ï¼š

```yaml
spring:
  datasource:
    password: ä½ çš„æ–°å¯†ç 
```

2. **é…ç½® HTTPS**

ä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦ï¼š

```bash
# å®‰è£… Certbot
sudo apt-get install certbot python3-certbot-nginx

# ç”³è¯·è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ï¼š0 0 * * * certbot renew --quiet
```

3. **é™åˆ¶ç«¯å£è®¿é—®**

åªå¼€æ”¾å¿…è¦çš„ç«¯å£ï¼ˆ80, 443ï¼‰ï¼Œå…³é—­ 8081 å’Œ 8001ï¼š

```bash
sudo ufw deny 8081
sudo ufw deny 8001
```

4. **å®šæœŸå¤‡ä»½**

è®¾ç½®è‡ªåŠ¨å¤‡ä»½ï¼ˆæ¯å¤©å‡Œæ™¨3ç‚¹ï¼‰ï¼š

```bash
sudo crontab -e
# æ·»åŠ ï¼š0 3 * * * /opt/health-management/scripts/backup.sh
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### 1. å¢åŠ å®¹å™¨èµ„æºé™åˆ¶

ç¼–è¾‘ `docker-compose.yml`ï¼š

```yaml
services:
  backend:
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 2G
        reservations:
          cpus: '1'
          memory: 1G
```

### 2. ä½¿ç”¨ CDN

å°†å‰ç«¯é™æ€èµ„æºä¸Šä¼ åˆ° CDNï¼Œæå‡è®¿é—®é€Ÿåº¦ã€‚

### 3. é…ç½® Redis ç¼“å­˜

æ·»åŠ  Redis æœåŠ¡åˆ° `docker-compose.yml`ï¼Œç¼“å­˜çƒ­ç‚¹æ•°æ®ã€‚

---

## ğŸ“ è·å–å¸®åŠ©

### æŸ¥çœ‹æ–‡æ¡£

- [QUICK_START.md](./QUICK_START.md) - å¿«é€Ÿå¼€å§‹
- [DEPLOYMENT.md](./DEPLOYMENT.md) - è¯¦ç»†éƒ¨ç½²æ–‡æ¡£

### æŸ¥çœ‹æ—¥å¿—

é‡åˆ°é—®é¢˜æ—¶ï¼Œå…ˆæŸ¥çœ‹æ—¥å¿—ï¼š

```bash
docker-compose logs -f
```

### ç³»ç»ŸçŠ¶æ€

è¿è¡Œå¥åº·æ£€æŸ¥ï¼š

```bash
./scripts/health-check.sh
```

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å‰æ£€æŸ¥ï¼š

- [ ] æœåŠ¡å™¨æ»¡è¶³æœ€ä½é…ç½®è¦æ±‚ï¼ˆ4GB RAM, 20GB ç£ç›˜ï¼‰
- [ ] Docker å’Œ Docker Compose å·²å®‰è£…
- [ ] å·²è·å–é€šä¹‰åƒé—® API Key
- [ ] å·²é…ç½®é˜¿é‡Œäº‘ OSS è®¿é—®å¯†é’¥
- [ ] å·²å¼€æ”¾å¿…è¦ç«¯å£ï¼ˆ80, 8081, 8001ï¼‰
- [ ] å¯ä»¥è®¿é—®æ•°æ®åº“æœåŠ¡å™¨

éƒ¨ç½²åéªŒè¯ï¼š

- [ ] æ‰€æœ‰å®¹å™¨æ­£å¸¸è¿è¡Œï¼ˆ`docker-compose ps`ï¼‰
- [ ] å‰ç«¯é¡µé¢å¯ä»¥è®¿é—®
- [ ] ç”¨æˆ·å¯ä»¥æ³¨å†Œå’Œç™»å½•
- [ ] èŠå¤©åŠŸèƒ½æ­£å¸¸
- [ ] ç—…å†ä¸Šä¼ åŠŸèƒ½æ­£å¸¸

---

**éƒ¨ç½²å®Œæˆï¼** ğŸ‰

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·å‚è€ƒ [DEPLOYMENT.md](./DEPLOYMENT.md) æˆ–æŸ¥çœ‹æœåŠ¡æ—¥å¿—è¿›è¡Œæ’æŸ¥ã€‚




