# å¥åº·ç®¡ç†ç³»ç»Ÿ - éƒ¨ç½²æ–¹å¼å¯¹æ¯”

## ğŸ“Š ä¸¤ç§éƒ¨ç½²æ–¹æ¡ˆ

æˆ‘ä¸ºä½ å‡†å¤‡äº†ä¸¤å¥—å®Œæ•´çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œä½ å¯ä»¥æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©ï¼š

| ç‰¹æ€§ | Nginx ä¼ ç»Ÿéƒ¨ç½² â­ | Docker å®¹å™¨åŒ–éƒ¨ç½² |
|------|------------------|-------------------|
| **å¤æ‚åº¦** | ç®€å•ç›´æ¥ | éœ€è¦å­¦ä¹  Docker |
| **éƒ¨ç½²é€Ÿåº¦** | å¿«é€Ÿ | é¦–æ¬¡æ„å»ºè¾ƒæ…¢ |
| **ç¯å¢ƒä¾èµ–** | éœ€è¦é€ä¸ªå®‰è£… | ç¯å¢ƒéš”ç¦»ï¼Œæ— éœ€æ‹…å¿ƒå†²çª |
| **èµ„æºå ç”¨** | è¾ƒä½ | ç¨é«˜ï¼ˆå®¹å™¨å¼€é”€ï¼‰ |
| **è¿ç§»éš¾åº¦** | è¾ƒéš¾ | å®¹æ˜“ï¼ˆæ‰“åŒ…å³èµ°ï¼‰ |
| **é€‚ç”¨åœºæ™¯** | å•æœåŠ¡å™¨éƒ¨ç½² | å¤šç¯å¢ƒã€äº‘åŸç”Ÿéƒ¨ç½² |
| **ç»´æŠ¤æˆæœ¬** | ä¸­ç­‰ | ä½ï¼ˆæ ‡å‡†åŒ–ï¼‰ |

## ğŸ¯ ä½ é€‰æ‹©çš„æ–¹æ¡ˆï¼šNginx ä¼ ç»Ÿéƒ¨ç½²

æ ¹æ®ä½ çš„éœ€æ±‚ï¼Œæˆ‘å·²ç»ä¸ºä½ åˆ›å»ºäº†å®Œæ•´çš„ Nginx ä¼ ç»Ÿéƒ¨ç½²æ–¹æ¡ˆã€‚

---

## ğŸ“¦ Nginx ä¼ ç»Ÿéƒ¨ç½²æ–‡ä»¶æ¸…å•

### æ ¸å¿ƒæ–‡ä»¶
```
healthManagement/
â”œâ”€â”€ deploy-nginx.sh                    # â­ ä¸€é”®éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ Nginxéƒ¨ç½²æŒ‡å—.md                   # â­ å¿«é€ŸæŒ‡å—ï¼ˆå»ºè®®å…ˆçœ‹ï¼‰
â”œâ”€â”€ DEPLOYMENT_NGINX.md                # è¯¦ç»†éƒ¨ç½²æ–‡æ¡£
â”‚
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ health-management.conf         # Nginx å®Œæ•´é…ç½®
â”‚
â”œâ”€â”€ systemd/
â”‚   â”œâ”€â”€ health-backend.service         # åç«¯ Systemd æœåŠ¡
â”‚   â””â”€â”€ health-ai-service.service      # AI Systemd æœåŠ¡
â”‚
â””â”€â”€ env.example                        # ç¯å¢ƒå˜é‡æ¨¡æ¿
```

### è¾…åŠ©è„šæœ¬
```
scripts/
â”œâ”€â”€ backup.sh                          # æ•°æ®å¤‡ä»½
â”œâ”€â”€ restore.sh                         # æ•°æ®æ¢å¤
â””â”€â”€ health-check.sh                    # å¥åº·æ£€æŸ¥
```

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æ­¥éª¤

### 1ï¸âƒ£ æœåŠ¡å™¨å‡†å¤‡

```bash
# åœ¨æœåŠ¡å™¨ä¸Šå®‰è£…ä¾èµ–
sudo apt-get update
sudo apt-get install -y openjdk-17-jdk nginx python3 python3-pip python3-venv

# å®‰è£… Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
```

### 2ï¸âƒ£ ä¸Šä¼ ä»£ç 

```bash
# æ–¹å¼ä¸€ï¼šGitï¼ˆæ¨èï¼‰
cd /opt
sudo git clone <ä½ çš„ä»“åº“åœ°å€> health-management

# æ–¹å¼äºŒï¼šSCP
# æœ¬åœ°æ‰§è¡Œï¼š
tar -czf health.tar.gz healthManagement/ --exclude=node_modules --exclude=target
scp health.tar.gz root@æœåŠ¡å™¨IP:/opt/

# æœåŠ¡å™¨æ‰§è¡Œï¼š
cd /opt
tar -xzf health.tar.gz
mv healthManagement health-management
```

### 3ï¸âƒ£ é…ç½®ç¯å¢ƒ

```bash
cd /opt/health-management

# å¤åˆ¶ç¯å¢ƒå˜é‡
cp env.example .env

# ç¼–è¾‘é…ç½®ï¼ˆå¡«å…¥çœŸå®çš„ API Keyï¼‰
vi .env
```

éœ€è¦é…ç½®ï¼š
```bash
DASHSCOPE_API_KEY=ä½ çš„é€šä¹‰åƒé—®APIå¯†é’¥
ALIYUN_OSS_ACCESS_KEY_ID=ä½ çš„OSSå¯†é’¥ID
ALIYUN_OSS_ACCESS_KEY_SECRET=ä½ çš„OSSå¯†é’¥Secret
```

### 4ï¸âƒ£ ä¸€é”®éƒ¨ç½²

```bash
chmod +x deploy-nginx.sh
sudo ./deploy-nginx.sh
```

**å®Œæˆï¼** è®¿é—® `http://æœåŠ¡å™¨IP`

---

## ğŸ“– è¯¦ç»†æ–‡æ¡£å¯¼èˆª

### å¼€å§‹éƒ¨ç½²
1. **Nginxéƒ¨ç½²æŒ‡å—.md** â­ - æ¨èå…ˆçœ‹ï¼Œç®€æ´å¿«é€Ÿ
2. **DEPLOYMENT_NGINX.md** - è¯¦ç»†çš„éƒ¨ç½²æ–‡æ¡£ï¼ŒåŒ…å«æ•…éšœæ’æŸ¥

### å…¶ä»–æ–‡æ¡£
- **éƒ¨ç½²è¯´æ˜.md** - Docker éƒ¨ç½²çš„ä¸­æ–‡è¯´æ˜ï¼ˆå¦‚æœä½ æ”¹å˜ä¸»æ„ï¼‰
- **DEPLOYMENT.md** - Docker éƒ¨ç½²çš„è¯¦ç»†æ–‡æ¡£
- **QUICK_START.md** - Docker 5åˆ†é’Ÿå¿«é€Ÿéƒ¨ç½²

---

## ğŸ”§ éƒ¨ç½²åç®¡ç†

### æœåŠ¡ç®¡ç†

```bash
# åç«¯æœåŠ¡
sudo systemctl start health-backend      # å¯åŠ¨
sudo systemctl stop health-backend       # åœæ­¢
sudo systemctl restart health-backend    # é‡å¯
sudo systemctl status health-backend     # çŠ¶æ€

# AI æœåŠ¡
sudo systemctl start health-ai-service
sudo systemctl stop health-ai-service
sudo systemctl restart health-ai-service
sudo systemctl status health-ai-service

# Nginx
sudo systemctl restart nginx
sudo systemctl status nginx
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# åç«¯æ—¥å¿—
sudo journalctl -u health-backend -f

# AI æœåŠ¡æ—¥å¿—
sudo journalctl -u health-ai-service -f

# Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/health-management-access.log
```

### æ›´æ–°ä»£ç 

```bash
cd /opt/health-management
git pull

# é‡æ–°æ„å»ºå‰ç«¯
cd frontend
npm run build

# é‡æ–°æ„å»ºåç«¯
cd ../backend
./mvnw clean package -DskipTests

# é‡å¯æœåŠ¡
sudo systemctl restart health-backend
sudo systemctl restart health-ai-service
sudo systemctl reload nginx
```

---

## ğŸ—ï¸ éƒ¨ç½²æ¶æ„

### Nginx ä¼ ç»Ÿéƒ¨ç½²æ¶æ„

```
Internet
    â†“
Nginx (ç«¯å£ 80)
â”œâ”€â”€ /          â†’ é™æ€æ–‡ä»¶ (/opt/health-management/frontend/dist/)
â”œâ”€â”€ /api/      â†’ åå‘ä»£ç†åˆ°åç«¯ (127.0.0.1:8081)
â””â”€â”€ /ai/       â†’ åå‘ä»£ç†åˆ° AI (127.0.0.1:8001)

Systemd æœåŠ¡:
â”œâ”€â”€ health-backend.service     â†’ Spring Boot (ç«¯å£ 8081)
â””â”€â”€ health-ai-service.service  â†’ FastAPI (ç«¯å£ 8001)

æ•°æ®å­˜å‚¨:
â”œâ”€â”€ PostgreSQL (å¤–éƒ¨æ•°æ®åº“: 47.94.41.55:5432)
â”œâ”€â”€ ä¸Šä¼ æ–‡ä»¶ (/opt/health-management/backend/uploads/)
â””â”€â”€ æ—¥å¿—æ–‡ä»¶ (/opt/health-management/logs/)
```

---

## ğŸ” é‡è¦æ–‡ä»¶ä½ç½®

### é…ç½®æ–‡ä»¶
| æ–‡ä»¶ | ä½ç½® |
|------|------|
| Nginx é…ç½® | `/etc/nginx/sites-available/health-management.conf` |
| åç«¯æœåŠ¡é…ç½® | `/etc/systemd/system/health-backend.service` |
| AI æœåŠ¡é…ç½® | `/etc/systemd/system/health-ai-service.service` |
| ç¯å¢ƒå˜é‡ | `/opt/health-management/.env` |
| åç«¯é…ç½® | `/opt/health-management/backend/.../application-prod.yml` |

### åº”ç”¨æ–‡ä»¶
| å†…å®¹ | ä½ç½® |
|------|------|
| å‰ç«¯é™æ€æ–‡ä»¶ | `/opt/health-management/frontend/dist/` |
| åç«¯ JAR | `/opt/health-management/backend/target/*.jar` |
| Python è™šæ‹Ÿç¯å¢ƒ | `/opt/health-management/ai-service/venv/` |
| ä¸Šä¼ æ–‡ä»¶ | `/opt/health-management/backend/uploads/` |

### æ—¥å¿—æ–‡ä»¶
| æ—¥å¿— | ä½ç½® |
|------|------|
| åç«¯æ—¥å¿— | `journalctl -u health-backend` |
| AI æœåŠ¡æ—¥å¿— | `journalctl -u health-ai-service` |
| Nginx è®¿é—®æ—¥å¿— | `/var/log/nginx/health-management-access.log` |
| Nginx é”™è¯¯æ—¥å¿— | `/var/log/nginx/health-management-error.log` |
| åº”ç”¨æ—¥å¿— | `/opt/health-management/logs/` |

---

## âš¡ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çŠ¶æ€
sudo systemctl status health-backend health-ai-service nginx

# é‡å¯æ‰€æœ‰æœåŠ¡
sudo systemctl restart health-backend health-ai-service nginx

# æŸ¥çœ‹æ‰€æœ‰å®æ—¶æ—¥å¿—
sudo journalctl -u health-backend -u health-ai-service -f

# æµ‹è¯• API
curl http://localhost/api/auth/health

# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½ Nginxï¼ˆæ— éœ€é‡å¯ï¼‰
sudo nginx -s reload
```

---

## ğŸ†˜ å¸¸è§é—®é¢˜

### 1. æœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
sudo journalctl -u health-backend -n 100 --no-pager

# æ‰‹åŠ¨æµ‹è¯•å¯åŠ¨
cd /opt/health-management/backend
java -jar target/health-management-0.0.1-SNAPSHOT.jar
```

### 2. é¡µé¢æ— æ³•è®¿é—®

```bash
# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
sudo ufw allow 80/tcp

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### 3. API è¯·æ±‚ 404

```bash
# æµ‹è¯•åç«¯æœåŠ¡
curl http://localhost:8081/api/auth/health

# æ£€æŸ¥ Nginx ä»£ç†é…ç½®
sudo cat /etc/nginx/sites-available/health-management.conf

# æµ‹è¯• Nginx é…ç½®
sudo nginx -t
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **é˜…è¯»å¿«é€ŸæŒ‡å—**ï¼š`Nginxéƒ¨ç½²æŒ‡å—.md`
2. **å‡†å¤‡æœåŠ¡å™¨**ï¼šå®‰è£…å¿…è¦çš„ä¾èµ–
3. **ä¸Šä¼ ä»£ç **ï¼šå°†é¡¹ç›®ä»£ç ä¸Šä¼ åˆ° `/opt/health-management`
4. **é…ç½®ç¯å¢ƒå˜é‡**ï¼šç¼–è¾‘ `.env` æ–‡ä»¶
5. **æ‰§è¡Œéƒ¨ç½²**ï¼šè¿è¡Œ `sudo ./deploy-nginx.sh`
6. **éªŒè¯éƒ¨ç½²**ï¼šè®¿é—® `http://æœåŠ¡å™¨IP`

---

## ğŸ”„ å¦‚æœæƒ³åˆ‡æ¢åˆ° Docker éƒ¨ç½²

å¦‚æœä»¥åæƒ³æ”¹ç”¨ Docker éƒ¨ç½²ï¼Œåªéœ€ï¼š

```bash
# åœæ­¢ Systemd æœåŠ¡
sudo systemctl stop health-backend health-ai-service

# ä½¿ç”¨ Docker éƒ¨ç½²
./deploy.sh  # é€‰æ‹©é€‰é¡¹ 1

# æ›´æ–° Nginx é…ç½®ä»¥ä»£ç†åˆ° Docker å®¹å™¨
# æˆ–è€…ç›´æ¥ä½¿ç”¨ Docker çš„å‰ç«¯å®¹å™¨ï¼ˆç«¯å£ 80ï¼‰
```

---

## ğŸ“ è·å–å¸®åŠ©

- **å¿«é€Ÿå‚è€ƒ**ï¼š`Nginxéƒ¨ç½²æŒ‡å—.md`
- **è¯¦ç»†æ–‡æ¡£**ï¼š`DEPLOYMENT_NGINX.md`
- **æŸ¥çœ‹æ—¥å¿—**ï¼š`sudo journalctl -u health-backend -f`
- **å¥åº·æ£€æŸ¥**ï¼š`./scripts/health-check.sh`

---

**ç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼** ğŸ‰

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ç›¸åº”æ–‡æ¡£æˆ–æ—¥å¿—è¿›è¡Œæ’æŸ¥ã€‚




