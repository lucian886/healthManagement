# å¿«é€Ÿé…ç½®æŒ‡å— - åŸŸåç»‘å®šå¥åº·ç®¡ç†ç³»ç»Ÿ

## ğŸ¯ éœ€æ±‚

- **åšå®¢**ï¼šä¸éœ€è¦åŸŸåï¼Œé€šè¿‡ IP è®¿é—®
- **å¥åº·ç®¡ç†**ï¼šéœ€è¦åŸŸå `health-management.top`

---

## ğŸ’¡ ä¸¤ä¸ªæ–¹æ¡ˆé€‰æ‹©

### æ–¹æ¡ˆä¸€ï¼šæ¨èæ–¹æ¡ˆï¼ˆåŸŸåç”¨ 80 ç«¯å£ï¼‰â­

**ä¼˜ç‚¹**ï¼š
- âœ… è®¿é—®ç®€æ´ï¼Œä¸éœ€è¦åŠ ç«¯å£å·
- âœ… å¯ä»¥é…ç½® HTTPSï¼ˆæ›´å®‰å…¨ï¼‰
- âœ… ç¬¦åˆ Web æ ‡å‡†

**è®¿é—®æ–¹å¼**ï¼š
- åšå®¢ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:8888`
- å¥åº·ç®¡ç†ï¼š`http://health-management.top`ï¼ˆè‡ªåŠ¨è·³è½¬ HTTPS åä¸º `https://health-management.top`ï¼‰

**é…ç½®æ–‡ä»¶**ï¼š`recommended-config.conf`

---

### æ–¹æ¡ˆäºŒï¼šå¤‡é€‰æ–¹æ¡ˆï¼ˆå¥åº·ç®¡ç†ç”¨ 8080 ç«¯å£ï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… åšå®¢ä¿æŒ 80 ç«¯å£ä¸å˜

**ç¼ºç‚¹**ï¼š
- âŒ è®¿é—®éœ€è¦åŠ ç«¯å£å· `:8080`
- âŒ ä¸èƒ½é…ç½®æ ‡å‡† HTTPSï¼ˆéœ€è¦ 443 ç«¯å£ï¼‰
- âŒ éœ€è¦å¼€æ”¾ 8080 ç«¯å£

**è®¿é—®æ–¹å¼**ï¼š
- åšå®¢ï¼š`http://ä½ çš„æœåŠ¡å™¨IP`
- å¥åº·ç®¡ç†ï¼š`http://health-management.top:8080`

**é…ç½®æ–‡ä»¶**ï¼š`alternative-config.conf`

---

## ğŸš€ æ–¹æ¡ˆä¸€ï¼šæ¨èé…ç½®ï¼ˆ3æ­¥å®Œæˆï¼‰

### ç¬¬ä¸€æ­¥ï¼šé˜¿é‡Œäº‘ DNS è§£æ

ç™»å½•ï¼šhttps://dns.console.aliyun.com/

æ·»åŠ ä¸¤æ¡ A è®°å½•ï¼š

```
è®°å½•1ï¼š
è®°å½•ç±»å‹ï¼šA
ä¸»æœºè®°å½•ï¼š@
è®°å½•å€¼ï¼šä½ çš„æœåŠ¡å™¨IP

è®°å½•2ï¼š
è®°å½•ç±»å‹ï¼šA
ä¸»æœºè®°å½•ï¼šwww
è®°å½•å€¼ï¼šä½ çš„æœåŠ¡å™¨IP
```

ç­‰å¾… 5-10 åˆ†é’Ÿç”Ÿæ•ˆã€‚

---

### ç¬¬äºŒæ­¥ï¼šæœåŠ¡å™¨é…ç½® Nginx

#### æ–¹æ³•Aï¼šä¸Šä¼ é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰

åœ¨æœ¬åœ°æ‰§è¡Œï¼š

```bash
scp /Users/liuzixuan/healthManagement/nginx/recommended-config.conf \
    root@ä½ çš„æœåŠ¡å™¨IP:/etc/nginx/conf.d/health-management.conf
```

#### æ–¹æ³•Bï¼šæ‰‹åŠ¨åˆ›å»ºé…ç½®

SSH ç™»å½•æœåŠ¡å™¨ï¼š

```bash
ssh root@ä½ çš„æœåŠ¡å™¨IP
```

åˆ›å»ºé…ç½®æ–‡ä»¶ï¼š

```bash
sudo vi /etc/nginx/conf.d/health-management.conf
```

å¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š

```nginx
# åç«¯æœåŠ¡ upstream
upstream health_backend {
    server 127.0.0.1:8081;
    keepalive 32;
}

upstream health_ai {
    server 127.0.0.1:8001;
    keepalive 32;
}

# åšå®¢ - 8888 ç«¯å£
server {
    listen       8888;
    server_name  localhost;

    access_log  /var/log/nginx/blog-access.log;

    location / {
        root   /opt/app/hexo/public;
        index  index.html index.htm;
    }
}

# å¥åº·ç®¡ç† - 80 ç«¯å£ï¼ˆåŸŸåï¼‰
server {
    listen       80;
    server_name  health-management.top www.health-management.top;

    access_log  /var/log/nginx/health-management-access.log;
    error_log   /var/log/nginx/health-management-error.log;

    root   /opt/health-management/frontend/dist;
    index  index.html;
    client_max_body_size 10M;

    gzip on;
    gzip_types text/plain text/css application/json application/javascript;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /api/ {
        proxy_pass http://health_backend/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

**ä¿®æ”¹åŸæœ‰åšå®¢é…ç½®**ï¼š

å¦‚æœä½ çš„åšå®¢é…ç½®åœ¨ `/etc/nginx/conf.d/default.conf` æˆ–å…¶ä»–æ–‡ä»¶ä¸­ï¼Œéœ€è¦ä¿®æ”¹ç«¯å£ï¼š

```bash
# æ‰¾åˆ°åšå®¢é…ç½®æ–‡ä»¶
sudo vi /etc/nginx/conf.d/default.conf

# æˆ–
sudo vi /etc/nginx/nginx.conf
```

æŠŠåšå®¢çš„ `listen 80;` æ”¹ä¸º `listen 8888;`

ä¿å­˜å¹¶é€€å‡ºã€‚

---

### ç¬¬ä¸‰æ­¥ï¼šæµ‹è¯•å¹¶é‡å¯ Nginx

```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# å¦‚æœæ˜¾ç¤º "test is successful"ï¼Œé‡å¯ Nginx
sudo systemctl reload nginx

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status nginx
```

---

### ç¬¬å››æ­¥ï¼šè®¿é—®æµ‹è¯•

**åšå®¢**ï¼š
```
http://ä½ çš„æœåŠ¡å™¨IP:8888
```

**å¥åº·ç®¡ç†**ï¼š
```
http://health-management.top
```

---

### ç¬¬äº”æ­¥ï¼šé…ç½® HTTPSï¼ˆæ¨èï¼‰

```bash
# å®‰è£… Certbot
sudo apt-get install -y certbot python3-certbot-nginx

# ç”³è¯·è¯ä¹¦
sudo certbot --nginx -d health-management.top -d www.health-management.top

# é€‰æ‹© 2ï¼ˆHTTP è‡ªåŠ¨è·³è½¬ HTTPSï¼‰
```

å®Œæˆåè®¿é—®ï¼š
```
https://health-management.top
```

æµè§ˆå™¨åº”è¯¥æ˜¾ç¤º ğŸ”’ å®‰å…¨é”ï¼

---

## ğŸ”§ æ–¹æ¡ˆäºŒï¼šå¤‡é€‰é…ç½®ï¼ˆå¥åº·ç®¡ç†ç”¨ 8080ï¼‰

### é¢å¤–æ­¥éª¤ï¼šå¼€æ”¾ 8080 ç«¯å£

#### é˜¿é‡Œäº‘å®‰å…¨ç»„

ç™»å½•é˜¿é‡Œäº‘ ECS æ§åˆ¶å°ï¼Œæ·»åŠ è§„åˆ™ï¼š

```
åè®®ï¼šTCP
ç«¯å£ï¼š8080
æˆæƒå¯¹è±¡ï¼š0.0.0.0/0
```

#### æœåŠ¡å™¨é˜²ç«å¢™

```bash
# Ubuntu
sudo ufw allow 8080/tcp

# CentOS
sudo firewall-cmd --permanent --add-port=8080/tcp
sudo firewall-cmd --reload
```

### é…ç½®æ–‡ä»¶

ä½¿ç”¨ `alternative-config.conf`ï¼š

```bash
scp /Users/liuzixuan/healthManagement/nginx/alternative-config.conf \
    root@ä½ çš„æœåŠ¡å™¨IP:/etc/nginx/conf.d/health-management.conf
```

æˆ–æ‰‹åŠ¨åˆ›å»ºåï¼Œé‡å¯ Nginxï¼š

```bash
sudo nginx -t
sudo systemctl reload nginx
```

### è®¿é—®æµ‹è¯•

**åšå®¢**ï¼š
```
http://ä½ çš„æœåŠ¡å™¨IP
```

**å¥åº·ç®¡ç†**ï¼š
```
http://health-management.top:8080
```

**æ³¨æ„**ï¼šè¿™ä¸ªæ–¹æ¡ˆè®¿é—®åŸŸåæ—¶å¿…é¡»åŠ  `:8080`ï¼Œä¸”æ— æ³•é…ç½®æ ‡å‡† HTTPSã€‚

---

## ğŸ“Š ä¸¤ä¸ªæ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | æ–¹æ¡ˆä¸€ï¼ˆæ¨èï¼‰| æ–¹æ¡ˆäºŒï¼ˆå¤‡é€‰ï¼‰|
|-----|------------|------------|
| åŸŸåè®¿é—® | `health-management.top` | `health-management.top:8080` |
| HTTPS | âœ… å¯ä»¥é…ç½® | âŒ æ— æ³•é…ç½®æ ‡å‡†è¯ä¹¦ |
| å®‰å…¨æ€§ | âœ… é«˜ | âš ï¸ ä¸€èˆ¬ |
| ç”¨æˆ·ä½“éªŒ | âœ… å¥½ï¼ˆæ— éœ€ç«¯å£å·ï¼‰| âš ï¸ ä¸€èˆ¬ï¼ˆéœ€è¦è®°ç«¯å£ï¼‰|
| åšå®¢è®¿é—® | `IP:8888` | `IP` |
| é¢å¤–é…ç½® | éœ€è¦æ”¹åšå®¢ç«¯å£ | éœ€è¦å¼€æ”¾ 8080 ç«¯å£ |

---

## âœ… é…ç½®å®Œæˆæ£€æŸ¥

### DNS æ£€æŸ¥

```bash
ping health-management.top
```

åº”è¯¥è¿”å›ä½ çš„æœåŠ¡å™¨ IPã€‚

### æœåŠ¡æ£€æŸ¥

```bash
# æ£€æŸ¥åç«¯
sudo systemctl status health-backend

# æ£€æŸ¥ AI æœåŠ¡
sudo systemctl status health-ai-service

# æ£€æŸ¥ Nginx
sudo systemctl status nginx

# æ£€æŸ¥ç«¯å£
sudo netstat -tulnp | grep :80
sudo netstat -tulnp | grep :8081
```

### è®¿é—®æ£€æŸ¥

**æ–¹æ¡ˆä¸€**ï¼š
- [ ] åšå®¢ï¼š`http://æœåŠ¡å™¨IP:8888` å¯è®¿é—®
- [ ] å¥åº·ç®¡ç†ï¼š`http://health-management.top` å¯è®¿é—®
- [ ] HTTPSï¼š`https://health-management.top` å¯è®¿é—®ï¼ˆé…ç½®åï¼‰

**æ–¹æ¡ˆäºŒ**ï¼š
- [ ] åšå®¢ï¼š`http://æœåŠ¡å™¨IP` å¯è®¿é—®
- [ ] å¥åº·ç®¡ç†ï¼š`http://health-management.top:8080` å¯è®¿é—®

---

## ğŸ” å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šåŸŸåè®¿é—®æ˜¾ç¤ºåšå®¢å†…å®¹

**åŸå› **ï¼šNginx é…ç½®å†²çªï¼ŒåŸŸåè¢«åšå®¢çš„ `server_name` æ•è·ã€‚

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥æ‰€æœ‰ Nginx é…ç½®
sudo nginx -T | grep "server_name"

# ç¡®ä¿åšå®¢é…ç½®çš„ server_name æ˜¯ localhostï¼Œä¸æ˜¯åŸŸå
# å¥åº·ç®¡ç†é…ç½®çš„ server_name æ˜¯ health-management.top
```

### é—®é¢˜2ï¼š502 Bad Gateway

**åŸå› **ï¼šåç«¯æœåŠ¡æœªå¯åŠ¨æˆ–ç«¯å£ä¸å¯¹ã€‚

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥åç«¯æœåŠ¡
sudo systemctl status health-backend
sudo systemctl start health-backend

# æµ‹è¯•åç«¯ç«¯å£
curl http://localhost:8081/api/auth/health
```

### é—®é¢˜3ï¼šNginx é…ç½®å†²çª

**åŸå› **ï¼šå¤šä¸ªé…ç½®æ–‡ä»¶ç›‘å¬åŒä¸€ä¸ªç«¯å£å’ŒåŸŸåã€‚

**è§£å†³**ï¼š
```bash
# æŸ¥çœ‹æ‰€æœ‰é…ç½®
ls -la /etc/nginx/conf.d/
ls -la /etc/nginx/sites-enabled/

# åˆ é™¤æ—§çš„æˆ–å†²çªçš„é…ç½®
sudo rm /etc/nginx/sites-enabled/default
sudo rm /etc/nginx/conf.d/default.conf

# é‡å¯ Nginx
sudo nginx -t
sudo systemctl reload nginx
```

---

## ğŸ“ ç®¡ç†å‘½ä»¤

```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½ï¼ˆä¸ä¸­æ–­æœåŠ¡ï¼‰
sudo systemctl reload nginx

# å®Œå…¨é‡å¯
sudo systemctl restart nginx

# æŸ¥çœ‹æ—¥å¿—
sudo tail -f /var/log/nginx/health-management-access.log
sudo tail -f /var/log/nginx/health-management-error.log
sudo tail -f /var/log/nginx/blog-access.log

# æŸ¥çœ‹æ‰€æœ‰é…ç½®
sudo nginx -T
```

---

## ğŸ‰ å®Œæˆ

**æ¨èä½¿ç”¨æ–¹æ¡ˆä¸€**ï¼Œè®¿é—®æ›´ç®€æ´ï¼Œæ›´å®‰å…¨ï¼

- **åšå®¢**ï¼š`http://ä½ çš„IP:8888`
- **å¥åº·ç®¡ç†**ï¼š`https://health-management.top` ğŸ”’

æœ‰é—®é¢˜éšæ—¶é—®æˆ‘ï¼ğŸš€




