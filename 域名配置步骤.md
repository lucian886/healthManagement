# åŸŸåé…ç½®æ­¥éª¤ - health-management.top

## ğŸ“‹ é…ç½®ä¿¡æ¯

- **åŸŸå**ï¼š`health-management.top` å’Œ `www.health-management.top`
- **ç›®æ ‡**ï¼šæ˜ å°„åˆ°å¥åº·ç®¡ç†ç³»ç»Ÿ
- **æœåŠ¡å™¨ç«¯å£**ï¼šåç«¯ 8081ï¼Œå‰ç«¯é€šè¿‡ Nginx 80 ç«¯å£è®¿é—®

---

## ç¬¬ä¸€æ­¥ï¼šé˜¿é‡Œäº‘ DNS è§£æé…ç½®

### 1.1 ç™»å½•é˜¿é‡Œäº‘æ§åˆ¶å°

è®¿é—®ï¼šhttps://dns.console.aliyun.com/

### 1.2 æ·»åŠ  DNS è§£æè®°å½•

æ‰¾åˆ°åŸŸå `health-management.top`ï¼Œç‚¹å‡»"è§£æè®¾ç½®"ï¼Œæ·»åŠ ä»¥ä¸‹ä¸¤æ¡è®°å½•ï¼š

#### è®°å½• 1ï¼šä¸»åŸŸå

```
è®°å½•ç±»å‹ï¼šA
ä¸»æœºè®°å½•ï¼š@
è®°å½•å€¼ï¼šä½ çš„æœåŠ¡å™¨å…¬ç½‘IPï¼ˆä¾‹å¦‚ï¼š47.94.41.55ï¼‰
TTLï¼š10åˆ†é’Ÿ
```

ç‚¹å‡»"ç¡®å®š"ä¿å­˜ã€‚

#### è®°å½• 2ï¼šwww å­åŸŸå

```
è®°å½•ç±»å‹ï¼šA
ä¸»æœºè®°å½•ï¼šwww
è®°å½•å€¼ï¼šä½ çš„æœåŠ¡å™¨å…¬ç½‘IPï¼ˆä¾‹å¦‚ï¼š47.94.41.55ï¼‰
TTLï¼š10åˆ†é’Ÿ
```

ç‚¹å‡»"ç¡®å®š"ä¿å­˜ã€‚

### 1.3 ç­‰å¾… DNS ç”Ÿæ•ˆ

DNS é€šå¸¸éœ€è¦ **5-10 åˆ†é’Ÿ**ç”Ÿæ•ˆã€‚

#### æµ‹è¯• DNS æ˜¯å¦ç”Ÿæ•ˆ

åœ¨æœ¬åœ°ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# æµ‹è¯•ä¸»åŸŸå
ping health-management.top

# æµ‹è¯• www åŸŸå
ping www.health-management.top

# å¦‚æœè¿”å›ä½ çš„æœåŠ¡å™¨ IPï¼Œè¯´æ˜è§£ææˆåŠŸï¼
```

---

## ç¬¬äºŒæ­¥ï¼šæœåŠ¡å™¨ Nginx é…ç½®

### 2.1 SSH ç™»å½•æœåŠ¡å™¨

```bash
ssh root@ä½ çš„æœåŠ¡å™¨IP
```

### 2.2 ä¸Šä¼ é…ç½®æ–‡ä»¶

æœ‰ä¸¤ç§æ–¹å¼ï¼š

#### æ–¹å¼ä¸€ï¼šæœ¬åœ°ä¸Šä¼ é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰

åœ¨æœ¬åœ°ç»ˆç«¯æ‰§è¡Œï¼š

```bash
# ä¸Šä¼ é…ç½®æ–‡ä»¶åˆ°æœåŠ¡å™¨
scp /Users/liuzixuan/healthManagement/nginx/health-management-domain.conf \
    root@ä½ çš„æœåŠ¡å™¨IP:/etc/nginx/sites-available/health-management.conf
```

#### æ–¹å¼äºŒï¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»º

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
# åˆ›å»ºé…ç½®æ–‡ä»¶
sudo vi /etc/nginx/sites-available/health-management.conf
```

ç„¶åå¤åˆ¶ä»¥ä¸‹å†…å®¹ï¼š

```nginx
# åç«¯æœåŠ¡ upstream
upstream health_backend {
    server 127.0.0.1:8081;
    keepalive 32;
}

# AI æœåŠ¡ upstream
upstream health_ai {
    server 127.0.0.1:8001;
    keepalive 32;
}

server {
    listen       80;
    server_name  health-management.top www.health-management.top;

    # æ—¥å¿—
    access_log  /var/log/nginx/health-management-access.log;
    error_log   /var/log/nginx/health-management-error.log;

    # å‰ç«¯é™æ€æ–‡ä»¶
    root   /opt/health-management/frontend/dist;
    index  index.html;

    # ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶
    client_max_body_size 10M;

    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_comp_level 6;
    gzip_types text/plain text/css text/xml text/javascript 
               application/json application/javascript application/xml+rss;

    # å‰ç«¯è·¯ç”± - SPA æ”¯æŒ
    location / {
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache";
    }

    # åç«¯ API ä»£ç†
    location /api/ {
        proxy_pass http://health_backend/api/;
        proxy_http_version 1.1;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header Connection "";
        
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
        
        proxy_buffering on;
        proxy_buffer_size 4k;
        proxy_buffers 8 4k;
        proxy_busy_buffers_size 8k;
    }

    # AI æœåŠ¡ä»£ç†
    location /ai/ {
        proxy_pass http://health_ai/;
        proxy_http_version 1.1;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }

    # é”™è¯¯é¡µé¢
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
```

ä¿å­˜å¹¶é€€å‡ºï¼ˆ`:wq`ï¼‰ã€‚

### 2.3 å¯ç”¨é…ç½®

```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -sf /etc/nginx/sites-available/health-management.conf \
            /etc/nginx/sites-enabled/health-management.conf

# å¦‚æœä¹‹å‰æœ‰æ—§çš„ 8080 ç«¯å£é…ç½®ï¼Œå¯ä»¥ç§»é™¤
# sudo rm -f /etc/nginx/sites-enabled/default
```

### 2.4 æµ‹è¯• Nginx é…ç½®

```bash
sudo nginx -t
```

åº”è¯¥æ˜¾ç¤ºï¼š
```
nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
nginx: configuration file /etc/nginx/nginx.conf test is successful
```

### 2.5 é‡å¯ Nginx

```bash
sudo systemctl reload nginx

# æˆ–å®Œå…¨é‡å¯
sudo systemctl restart nginx
```

### 2.6 æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥ Nginx
sudo systemctl status nginx

# æ£€æŸ¥åç«¯æœåŠ¡
sudo systemctl status health-backend

# æ£€æŸ¥ AI æœåŠ¡
sudo systemctl status health-ai-service
```

---

## ç¬¬ä¸‰æ­¥ï¼šé…ç½®é˜²ç«å¢™å’Œå®‰å…¨ç»„

### 3.1 é˜¿é‡Œäº‘å®‰å…¨ç»„

ç™»å½•é˜¿é‡Œäº‘ ECS æ§åˆ¶å°ï¼Œé…ç½®å®‰å…¨ç»„è§„åˆ™ï¼š

| åè®® | ç«¯å£ | æˆæƒå¯¹è±¡ | è¯´æ˜ |
|-----|------|---------|------|
| HTTP | 80 | 0.0.0.0/0 | HTTP è®¿é—® |
| HTTPS | 443 | 0.0.0.0/0 | HTTPS è®¿é—® |
| SSH | 22 | ä½ çš„IP/32 | SSH ç®¡ç† |

**æ³¨æ„**ï¼š8081 å’Œ 8001 ç«¯å£ä¸è¦å¯¹å¤–å¼€æ”¾ï¼Œåªå…è®¸æœ¬åœ°è®¿é—®ï¼

### 3.2 æœåŠ¡å™¨é˜²ç«å¢™

#### Ubuntu (UFW)

```bash
# å…è®¸ HTTP
sudo ufw allow 80/tcp

# å…è®¸ HTTPS
sudo ufw allow 443/tcp

# å…è®¸ SSH
sudo ufw allow 22/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹çŠ¶æ€
sudo ufw status
```

#### CentOS (Firewalld)

```bash
# å…è®¸ HTTP å’Œ HTTPS
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --permanent --add-service=ssh

# é‡æ–°åŠ è½½
sudo firewall-cmd --reload

# æŸ¥çœ‹çŠ¶æ€
sudo firewall-cmd --list-all
```

---

## ç¬¬å››æ­¥ï¼šæµ‹è¯•è®¿é—®

### 4.1 HTTP è®¿é—®æµ‹è¯•

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š

```
http://health-management.top
http://www.health-management.top
```

åº”è¯¥èƒ½çœ‹åˆ°å¥åº·ç®¡ç†ç³»ç»Ÿçš„ç™»å½•é¡µé¢ï¼

### 4.2 API æµ‹è¯•

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
# æµ‹è¯•å‰ç«¯
curl http://health-management.top

# æµ‹è¯•åç«¯ API
curl http://health-management.top/api/auth/health

# åº”è¯¥è¿”å›åç«¯çš„å¥åº·æ£€æŸ¥å“åº”
```

---

## ç¬¬äº”æ­¥ï¼šé…ç½® HTTPSï¼ˆæ¨èï¼‰

é…ç½® HTTPS å¯ä»¥ä¿æŠ¤ç”¨æˆ·æ•°æ®å®‰å…¨ï¼Œæå‡ SEO æ’åã€‚

### 5.1 å®‰è£… Certbot

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y certbot python3-certbot-nginx

# CentOS/RHEL
sudo yum install -y certbot python3-certbot-nginx
```

### 5.2 ç”³è¯·å…è´¹ SSL è¯ä¹¦

```bash
# ä¸€é”®ç”³è¯·å¹¶é…ç½®ï¼ˆæ¨èï¼‰
sudo certbot --nginx -d health-management.top -d www.health-management.top
```

æŒ‰ç…§æç¤ºæ“ä½œï¼š

1. **è¾“å…¥é‚®ç®±**ï¼šç”¨äºè¯ä¹¦åˆ°æœŸæé†’
   ```
   Enter email address: your-email@example.com
   ```

2. **åŒæ„æœåŠ¡æ¡æ¬¾**ï¼šè¾“å…¥ `Y`

3. **æ˜¯å¦åˆ†äº«é‚®ç®±**ï¼šè¾“å…¥ `N`

4. **HTTP é‡å®šå‘åˆ° HTTPS**ï¼š
   ```
   Please choose whether or not to redirect HTTP traffic to HTTPS:
   1: No redirect
   2: Redirect
   
   é€‰æ‹© 2ï¼ˆæ¨èï¼‰
   ```

### 5.3 éªŒè¯ HTTPS

è®¿é—®ï¼š

```
https://health-management.top
https://www.health-management.top
```

æµè§ˆå™¨åœ°å€æ åº”è¯¥æ˜¾ç¤º ğŸ”’ é”å›¾æ ‡ï¼

### 5.4 è‡ªåŠ¨ç»­æœŸ

Certbot å·²è‡ªåŠ¨é…ç½®ç»­æœŸä»»åŠ¡ï¼Œè¯ä¹¦ä¼šåœ¨åˆ°æœŸå‰è‡ªåŠ¨ç»­æœŸã€‚

æµ‹è¯•ç»­æœŸï¼š

```bash
sudo certbot renew --dry-run
```

---

## âœ… é…ç½®å®Œæˆæ£€æŸ¥æ¸…å•

### DNS é…ç½®
- [ ] å·²æ·»åŠ  `@` è®°å½•ï¼ˆä¸»åŸŸåï¼‰
- [ ] å·²æ·»åŠ  `www` è®°å½•
- [ ] DNS è§£æå·²ç”Ÿæ•ˆï¼ˆ`ping` æµ‹è¯•é€šè¿‡ï¼‰

### Nginx é…ç½®
- [ ] é…ç½®æ–‡ä»¶å·²åˆ›å»º
- [ ] `server_name` å·²æ”¹ä¸º `health-management.top www.health-management.top`
- [ ] Nginx é…ç½®æµ‹è¯•é€šè¿‡ï¼ˆ`nginx -t`ï¼‰
- [ ] Nginx å·²é‡å¯

### æœåŠ¡çŠ¶æ€
- [ ] åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸ï¼ˆ8081 ç«¯å£ï¼‰
- [ ] AI æœåŠ¡è¿è¡Œæ­£å¸¸ï¼ˆ8001 ç«¯å£ï¼‰
- [ ] Nginx è¿è¡Œæ­£å¸¸ï¼ˆ80 ç«¯å£ï¼‰

### å®‰å…¨é…ç½®
- [ ] é˜¿é‡Œäº‘å®‰å…¨ç»„å·²å¼€æ”¾ 80ã€443 ç«¯å£
- [ ] æœåŠ¡å™¨é˜²ç«å¢™å·²é…ç½®
- [ ] 8081ã€8001 ç«¯å£æœªå¯¹å¤–å¼€æ”¾

### HTTPS é…ç½®
- [ ] Certbot å·²å®‰è£…
- [ ] SSL è¯ä¹¦ç”³è¯·æˆåŠŸ
- [ ] HTTPS è®¿é—®æ­£å¸¸ï¼ˆæ˜¾ç¤º ğŸ”’ï¼‰
- [ ] HTTP è‡ªåŠ¨è·³è½¬ HTTPS

### åŠŸèƒ½æµ‹è¯•
- [ ] å¯ä»¥è®¿é—®å‰ç«¯é¡µé¢
- [ ] ç”¨æˆ·å¯ä»¥æ³¨å†Œç™»å½•
- [ ] API è¯·æ±‚æ­£å¸¸
- [ ] å›¾ç‰‡ä¸Šä¼ æ­£å¸¸
- [ ] èŠå¤©åŠŸèƒ½æ­£å¸¸

---

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šåŸŸåæ— æ³•è®¿é—®

```bash
# 1. æ£€æŸ¥ DNS è§£æ
ping health-management.top

# 2. æ£€æŸ¥ Nginx æ˜¯å¦è¿è¡Œ
sudo systemctl status nginx

# 3. æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/health-management-error.log

# 4. æ£€æŸ¥ç«¯å£
sudo netstat -tulnp | grep :80
```

### é—®é¢˜ 2ï¼š502 Bad Gateway

è¯´æ˜ Nginx æ— æ³•è¿æ¥åç«¯æœåŠ¡ã€‚

```bash
# æ£€æŸ¥åç«¯æœåŠ¡
sudo systemctl status health-backend

# æŸ¥çœ‹åç«¯æ—¥å¿—
sudo journalctl -u health-backend -n 50

# æµ‹è¯•åç«¯ç«¯å£
curl http://localhost:8081/api/auth/health
```

### é—®é¢˜ 3ï¼šå‰ç«¯é¡µé¢ç©ºç™½

```bash
# æ£€æŸ¥å‰ç«¯æ–‡ä»¶
ls -la /opt/health-management/frontend/dist/

# æŸ¥çœ‹ Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/health-management-error.log

# é‡æ–°æ„å»ºå‰ç«¯
cd /opt/health-management/frontend
npm run build
sudo systemctl reload nginx
```

---

## ğŸ“Š ç®¡ç†å‘½ä»¤

### Nginx ç®¡ç†

```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½ï¼ˆæ¨èï¼‰
sudo systemctl reload nginx

# å®Œå…¨é‡å¯
sudo systemctl restart nginx

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status nginx

# æŸ¥çœ‹æ—¥å¿—
sudo tail -f /var/log/nginx/health-management-access.log
sudo tail -f /var/log/nginx/health-management-error.log
```

### æœåŠ¡ç®¡ç†

```bash
# åç«¯æœåŠ¡
sudo systemctl start health-backend
sudo systemctl stop health-backend
sudo systemctl restart health-backend
sudo systemctl status health-backend

# AI æœåŠ¡
sudo systemctl start health-ai-service
sudo systemctl stop health-ai-service
sudo systemctl restart health-ai-service
sudo systemctl status health-ai-service

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u health-backend -f
sudo journalctl -u health-ai-service -f
```

### SSL è¯ä¹¦ç®¡ç†

```bash
# æŸ¥çœ‹è¯ä¹¦
sudo certbot certificates

# æ‰‹åŠ¨ç»­æœŸ
sudo certbot renew

# æµ‹è¯•ç»­æœŸ
sudo certbot renew --dry-run

# æ’¤é”€è¯ä¹¦
sudo certbot revoke --cert-path /etc/letsencrypt/live/health-management.top/cert.pem
```

---

## ğŸ‰ é…ç½®å®Œæˆï¼

ç°åœ¨ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®å¥åº·ç®¡ç†ç³»ç»Ÿï¼š

- **HTTP**ï¼šhttp://health-management.top
- **HTTPS**ï¼šhttps://health-management.top
- **å¸¦ www**ï¼šhttps://www.health-management.top

---

## ğŸ“ å…³äºåšå®¢æœåŠ¡

å¦‚æœä½ çš„åšå®¢è¿˜åœ¨ 80 ç«¯å£è¿è¡Œï¼Œéœ€è¦ï¼š

### æ–¹æ¡ˆ 1ï¼šæ›´æ¢åšå®¢ç«¯å£ï¼ˆæ¨èï¼‰

åšå®¢æ”¹ä¸º 8080 ç«¯å£ï¼Œè®©å¥åº·ç®¡ç†ç³»ç»Ÿä½¿ç”¨ 80 ç«¯å£ï¼š

```nginx
# åšå®¢ - 8080 ç«¯å£
server {
    listen       8080;
    server_name  localhost;
    
    location / {
        root   /opt/app/hexo/public;
        index  index.html index.htm;
    }
}
```

è®¿é—®ï¼š`http://ä½ çš„æœåŠ¡å™¨IP:8080`

### æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ä¸åŒåŸŸå

- åšå®¢ï¼šä½¿ç”¨å¦ä¸€ä¸ªåŸŸåï¼ˆå¦‚ `blog.health-management.top`ï¼‰
- å¥åº·ç®¡ç†ï¼šä½¿ç”¨ä¸»åŸŸå `health-management.top`

éœ€è¦åœ¨é˜¿é‡Œäº‘æ·»åŠ åšå®¢å­åŸŸåè§£æã€‚

---

**é…ç½®æ—¶é—´**ï¼šçº¦ 20-30 åˆ†é’Ÿ

**æœ‰é—®é¢˜éšæ—¶é—®æˆ‘ï¼** ğŸš€




