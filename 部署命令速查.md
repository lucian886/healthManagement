# éƒ¨ç½²å‘½ä»¤é€ŸæŸ¥è¡¨

## ğŸ”¨ æœ¬åœ°æ„å»º

### ä¸€é”®æ„å»ºï¼ˆæ¨èï¼‰
```bash
cd /Users/liuzixuan/healthManagement
./build-local.sh
```

### æ‰‹åŠ¨æ„å»º

**å‰ç«¯ï¼š**
```bash
cd /Users/liuzixuan/healthManagement/frontend
npm install          # é¦–æ¬¡æˆ–ä¾èµ–æ›´æ–°æ—¶
npm run build        # ç”Ÿæˆ dist/ æ–‡ä»¶å¤¹
tar -czf dist.tar.gz dist/  # æ‰“åŒ…ï¼ˆæ–¹ä¾¿ä¸Šä¼ ï¼‰
```

**åç«¯ï¼š**
```bash
cd /Users/liuzixuan/healthManagement/backend
mvn clean package -DskipTests  # ç”Ÿæˆ jar åŒ…
# äº§ç‰©: backend/target/health-management-1.0.0.jar
```

---

## ğŸ“¤ ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# ä¸Šä¼ å‰ç«¯
scp /Users/liuzixuan/healthManagement/frontend/dist.tar.gz \
    root@æœåŠ¡å™¨IP:/opt/health-management/frontend/

# ä¸Šä¼ åç«¯
scp /Users/liuzixuan/healthManagement/backend/target/health-management-1.0.0.jar \
    root@æœåŠ¡å™¨IP:/opt/health-management/backend/

# ä¸Šä¼  AI æœåŠ¡ï¼ˆé¦–æ¬¡éƒ¨ç½²ï¼‰
cd /Users/liuzixuan/healthManagement/ai-service
tar -czf ai-service.tar.gz *.py requirements.txt
scp ai-service.tar.gz root@æœåŠ¡å™¨IP:/opt/health-management/
```

---

## ğŸš€ æœåŠ¡å™¨ç«¯éƒ¨ç½²

### é¦–æ¬¡éƒ¨ç½²

```bash
# SSH ç™»å½•æœåŠ¡å™¨
ssh root@æœåŠ¡å™¨IP

# 1. è§£å‹å‰ç«¯
cd /opt/health-management/frontend
tar -xzf dist.tar.gz

# 2. é…ç½® Nginx
sudo vi /etc/nginx/sites-available/health-management
# ç²˜è´´ä»¥ä¸‹å†…å®¹ï¼š

server {
    listen 80;
    server_name localhost;
    root /opt/health-management/frontend/dist;
    index index.html;
    client_max_body_size 10M;
    
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    location /api/ {
        proxy_pass http://127.0.0.1:8081/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}

# å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/health-management /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx

# 3. å¯åŠ¨åç«¯
cd /opt/health-management/backend
nohup java -jar health-management-1.0.0.jar \
    --spring.profiles.active=prod \
    > backend.log 2>&1 &

# 4. å¯åŠ¨ AI æœåŠ¡
cd /opt/health-management/ai-service
export DASHSCOPE_API_KEY="ä½ çš„APIå¯†é’¥"
pip3 install -r requirements.txt
nohup python3 main.py > ai-service.log 2>&1 &

# 5. éªŒè¯
ps aux | grep -E "health-management|main.py"
curl http://localhost/api/auth/health
```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### æ›´æ–°å‰ç«¯

```bash
# æœ¬åœ°
cd /Users/liuzixuan/healthManagement/frontend
npm run build
tar -czf dist.tar.gz dist/
scp dist.tar.gz root@æœåŠ¡å™¨IP:/opt/health-management/frontend/

# æœåŠ¡å™¨
ssh root@æœåŠ¡å™¨IP
cd /opt/health-management/frontend
rm -rf dist
tar -xzf dist.tar.gz
# æµè§ˆå™¨æ¸…ç¼“å­˜åˆ·æ–°å³å¯
```

### æ›´æ–°åç«¯

```bash
# æœ¬åœ°
cd /Users/liuzixuan/healthManagement/backend
mvn clean package -DskipTests
scp target/health-management-1.0.0.jar root@æœåŠ¡å™¨IP:/opt/health-management/backend/

# æœåŠ¡å™¨
ssh root@æœåŠ¡å™¨IP

# åœæ­¢æ—§è¿›ç¨‹
ps aux | grep health-management-1.0.0.jar
kill <PID>
# æˆ–ä½¿ç”¨: pkill -f health-management-1.0.0.jar

# å¯åŠ¨æ–°ç‰ˆæœ¬
cd /opt/health-management/backend
nohup java -jar health-management-1.0.0.jar \
    --spring.profiles.active=prod \
    > backend.log 2>&1 &

# æŸ¥çœ‹æ—¥å¿—
tail -f backend.log
```

### æ›´æ–° AI æœåŠ¡

```bash
# æœ¬åœ°
cd /Users/liuzixuan/healthManagement/ai-service
scp main.py agent.py tools.py config.py root@æœåŠ¡å™¨IP:/opt/health-management/ai-service/

# æœåŠ¡å™¨
ssh root@æœåŠ¡å™¨IP
pkill -f "python3 main.py"
cd /opt/health-management/ai-service
export DASHSCOPE_API_KEY="ä½ çš„APIå¯†é’¥"
nohup python3 main.py > ai-service.log 2>&1 &
```

---

## ğŸ” æœåŠ¡ç®¡ç†

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep -E "health-management|main.py|nginx"

# æŸ¥çœ‹ç«¯å£
netstat -tulnp | grep -E "80|8081|8001"
# æˆ–ä½¿ç”¨: lsof -i :80 -i :8081 -i :8001
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# åç«¯æ—¥å¿—
tail -f /opt/health-management/backend/backend.log

# AI æœåŠ¡æ—¥å¿—
tail -f /opt/health-management/ai-service/ai-service.log

# Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### åœæ­¢æœåŠ¡

```bash
# åœæ­¢åç«¯
pkill -f health-management-1.0.0.jar

# åœæ­¢ AI æœåŠ¡
pkill -f "python3 main.py"

# é‡å¯ Nginx
sudo systemctl restart nginx
```

### é‡å¯æœåŠ¡

```bash
# é‡å¯åç«¯
pkill -f health-management-1.0.0.jar
cd /opt/health-management/backend
nohup java -jar health-management-1.0.0.jar --spring.profiles.active=prod > backend.log 2>&1 &

# é‡å¯ AI æœåŠ¡
pkill -f "python3 main.py"
cd /opt/health-management/ai-service
export DASHSCOPE_API_KEY="ä½ çš„APIå¯†é’¥"
nohup python3 main.py > ai-service.log 2>&1 &
```

---

## ğŸ§ª æµ‹è¯•æ¥å£

```bash
# æµ‹è¯•åç«¯
curl http://localhost:8081/api/auth/health

# æµ‹è¯• AI æœåŠ¡
curl http://localhost:8001/health

# æµ‹è¯• Nginx ä»£ç†
curl http://localhost/api/auth/health

# æµ‹è¯•å‰ç«¯
curl http://localhost/
```

---

## ğŸ“ æ–‡ä»¶ä½ç½®

### æœ¬åœ°
- å‰ç«¯äº§ç‰©: `/Users/liuzixuan/healthManagement/frontend/dist/`
- å‰ç«¯å‹ç¼©åŒ…: `/Users/liuzixuan/healthManagement/frontend/dist.tar.gz`
- åç«¯äº§ç‰©: `/Users/liuzixuan/healthManagement/backend/target/health-management-1.0.0.jar`

### æœåŠ¡å™¨
- å‰ç«¯: `/opt/health-management/frontend/dist/`
- åç«¯: `/opt/health-management/backend/health-management-1.0.0.jar`
- AI æœåŠ¡: `/opt/health-management/ai-service/`
- Nginx é…ç½®: `/etc/nginx/sites-available/health-management`
- æ—¥å¿—: `/opt/health-management/backend/backend.log`
- æ—¥å¿—: `/opt/health-management/ai-service/ai-service.log`

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### å‰ç«¯é¡µé¢ç©ºç™½

```bash
# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t
sudo cat /etc/nginx/sites-available/health-management

# æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /opt/health-management/frontend/dist/

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### API è¯·æ±‚å¤±è´¥

```bash
# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
ps aux | grep health-management

# æ£€æŸ¥ç«¯å£
netstat -tulnp | grep 8081

# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f /opt/health-management/backend/backend.log
```

### ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo lsof -i :80
sudo lsof -i :8081
sudo lsof -i :8001

# åœæ­¢å ç”¨è¿›ç¨‹
sudo kill <PID>
```

---

## ğŸ”’ ç¯å¢ƒå˜é‡é…ç½®

### åˆ›å»º .env æ–‡ä»¶ï¼ˆæœåŠ¡å™¨ï¼‰

```bash
sudo vi /opt/health-management/.env
```

å†…å®¹ï¼š
```bash
DASHSCOPE_API_KEY=ä½ çš„é€šä¹‰åƒé—®APIå¯†é’¥
ALIYUN_OSS_ACCESS_KEY_ID=ä½ çš„OSSå¯†é’¥ID
ALIYUN_OSS_ACCESS_KEY_SECRET=ä½ çš„OSSå¯†é’¥Secret
```

### ä½¿ç”¨ç¯å¢ƒå˜é‡å¯åŠ¨

```bash
# åŠ è½½ç¯å¢ƒå˜é‡
source /opt/health-management/.env

# å¯åŠ¨åç«¯ï¼ˆç¯å¢ƒå˜é‡ä¼šè‡ªåŠ¨ä¼ é€’ï¼‰
cd /opt/health-management/backend
nohup java -jar health-management-1.0.0.jar \
    --spring.profiles.active=prod \
    > backend.log 2>&1 &

# å¯åŠ¨ AI æœåŠ¡
cd /opt/health-management/ai-service
nohup python3 main.py > ai-service.log 2>&1 &
```

---

## ğŸ“Š å®Œæ•´éƒ¨ç½²æµç¨‹

```bash
# ===== æ­¥éª¤ 1: æœ¬åœ°æ„å»º =====
cd /Users/liuzixuan/healthManagement
./build-local.sh

# ===== æ­¥éª¤ 2: ä¸Šä¼ æ–‡ä»¶ =====
scp frontend/dist.tar.gz root@IP:/opt/health-management/frontend/
scp backend/target/health-management-1.0.0.jar root@IP:/opt/health-management/backend/

# ===== æ­¥éª¤ 3: æœåŠ¡å™¨éƒ¨ç½² =====
ssh root@IP

# è§£å‹å‰ç«¯
cd /opt/health-management/frontend && tar -xzf dist.tar.gz

# é…ç½® Nginxï¼ˆé¦–æ¬¡ï¼‰
sudo vi /etc/nginx/sites-available/health-management
sudo ln -s /etc/nginx/sites-available/health-management /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl restart nginx

# å¯åŠ¨åç«¯
cd /opt/health-management/backend
nohup java -jar health-management-1.0.0.jar --spring.profiles.active=prod > backend.log 2>&1 &

# å¯åŠ¨ AI æœåŠ¡
cd /opt/health-management/ai-service
export DASHSCOPE_API_KEY="ä½ çš„å¯†é’¥"
nohup python3 main.py > ai-service.log 2>&1 &

# ===== æ­¥éª¤ 4: éªŒè¯ =====
curl http://localhost/api/auth/health
# æµè§ˆå™¨è®¿é—®: http://æœåŠ¡å™¨IP
```

---

**å®Œæˆï¼** ğŸ‰




