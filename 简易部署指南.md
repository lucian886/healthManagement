# å¥åº·ç®¡ç†ç³»ç»Ÿ - ç®€æ˜“éƒ¨ç½²æŒ‡å—

## ğŸ¯ éƒ¨ç½²æµç¨‹

```
1. å‰ç«¯æ‰“åŒ… â†’ dist æ–‡ä»¶å¤¹
2. åç«¯æ‰“åŒ… â†’ jar åŒ…
3. é…ç½® Nginx â†’ æŒ‡å‘ dist å’Œä»£ç†åç«¯
4. å¯åŠ¨æœåŠ¡ â†’ åç«¯ + AI æœåŠ¡
```

---

## ğŸ“¦ ç¬¬ä¸€æ­¥ï¼šæ„å»ºå‰ç«¯ (ç”Ÿæˆ dist æ–‡ä»¶å¤¹)

### æœ¬åœ°æ„å»ºï¼ˆæ¨èï¼‰

```bash
cd /Users/liuzixuan/healthManagement/frontend

# å®‰è£…ä¾èµ–ï¼ˆå¦‚æœè¿˜æ²¡å®‰è£…ï¼‰
npm install

# æ‰“åŒ…ç”Ÿæˆ dist æ–‡ä»¶å¤¹
npm run build
```

æ„å»ºå®Œæˆåï¼Œä¼šç”Ÿæˆ `frontend/dist/` æ–‡ä»¶å¤¹ï¼ŒåŒ…å«ï¼š
- `index.html`
- `assets/` (JSã€CSS ç­‰é™æ€èµ„æº)

### ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# å°† dist æ–‡ä»¶å¤¹ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp -r frontend/dist root@æœåŠ¡å™¨IP:/opt/health-management/frontend/

# æˆ–è€…æ‰“åŒ…åä¸Šä¼ 
cd frontend
tar -czf dist.tar.gz dist/
scp dist.tar.gz root@æœåŠ¡å™¨IP:/opt/health-management/frontend/
# åœ¨æœåŠ¡å™¨ä¸Šè§£å‹
# ssh root@æœåŠ¡å™¨IP
# cd /opt/health-management/frontend && tar -xzf dist.tar.gz
```

---

## ğŸ“¦ ç¬¬äºŒæ­¥ï¼šæ„å»ºåç«¯ (ç”Ÿæˆ jar åŒ…)

### æœ¬åœ°æ„å»º

```bash
cd /Users/liuzixuan/healthManagement/backend

# ä½¿ç”¨ Maven æ„å»ºï¼ˆè·³è¿‡æµ‹è¯•ï¼‰
./mvnw clean package -DskipTests

# æˆ–è€…å¦‚æœæœ‰å…¨å±€ Maven
mvn clean package -DskipTests
```

æ„å»ºå®Œæˆåï¼Œjar åŒ…ä½ç½®ï¼š
```
backend/target/health-management-0.0.1-SNAPSHOT.jar
```

### ä¸Šä¼ åˆ°æœåŠ¡å™¨

```bash
# ä¸Šä¼  jar åŒ…
scp backend/target/health-management-0.0.1-SNAPSHOT.jar \
    root@æœåŠ¡å™¨IP:/opt/health-management/backend/

# åŒæ—¶ä¸Šä¼ é…ç½®æ–‡ä»¶
scp backend/src/main/resources/application-prod.yml \
    root@æœåŠ¡å™¨IP:/opt/health-management/backend/
```

---

## ğŸ”§ ç¬¬ä¸‰æ­¥ï¼šé…ç½® Nginx

### åˆ›å»º Nginx é…ç½®æ–‡ä»¶

åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»ºé…ç½®æ–‡ä»¶ï¼š

```bash
sudo vi /etc/nginx/sites-available/health-management
```

ç²˜è´´ä»¥ä¸‹é…ç½®ï¼š

```nginx
server {
    listen 80;
    server_name localhost;  # æ”¹æˆä½ çš„åŸŸåæˆ– IP
    
    # å‰ç«¯é™æ€æ–‡ä»¶ç›®å½•
    root /opt/health-management/frontend/dist;
    index index.html;
    
    # ä¸Šä¼ æ–‡ä»¶å¤§å°é™åˆ¶
    client_max_body_size 10M;
    
    # å‰ç«¯è·¯ç”± - SPA æ”¯æŒ
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # åç«¯ API ä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:8081/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # é™æ€èµ„æºç¼“å­˜
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

### å¯ç”¨é…ç½®

```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/health-management /etc/nginx/sites-enabled/

# åˆ é™¤é»˜è®¤é…ç½®ï¼ˆå¯é€‰ï¼‰
sudo rm /etc/nginx/sites-enabled/default

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx
```

---

## ğŸš€ ç¬¬å››æ­¥ï¼šå¯åŠ¨æœåŠ¡

### 1. å¯åŠ¨åç«¯æœåŠ¡

```bash
# SSH ç™»å½•åˆ°æœåŠ¡å™¨
ssh root@æœåŠ¡å™¨IP

# è¿›å…¥åç«¯ç›®å½•
cd /opt/health-management/backend

# åå°å¯åŠ¨åç«¯ï¼ˆæ–¹å¼ä¸€ï¼šä½¿ç”¨ nohupï¼‰
nohup java -jar health-management-0.0.1-SNAPSHOT.jar \
    --spring.profiles.active=prod \
    > backend.log 2>&1 &

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep java

# æŸ¥çœ‹æ—¥å¿—
tail -f backend.log
```

**æˆ–è€…ä½¿ç”¨å±å¹•ä¼šè¯ï¼ˆæ–¹å¼äºŒï¼‰ï¼š**

```bash
# åˆ›å»ºæ–°ä¼šè¯
screen -S backend

# å¯åŠ¨åç«¯
cd /opt/health-management/backend
java -jar health-management-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod

# æŒ‰ Ctrl+A ç„¶åæŒ‰ D ç¦»å¼€ä¼šè¯ï¼ˆæœåŠ¡ç»§ç»­è¿è¡Œï¼‰
# é‡æ–°è¿æ¥: screen -r backend
```

### 2. å¯åŠ¨ AI æœåŠ¡

```bash
# è¿›å…¥ AI æœåŠ¡ç›®å½•
cd /opt/health-management/ai-service

# å®‰è£…ä¾èµ–ï¼ˆé¦–æ¬¡éœ€è¦ï¼‰
pip3 install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡
export DASHSCOPE_API_KEY="ä½ çš„é€šä¹‰åƒé—®APIå¯†é’¥"

# åå°å¯åŠ¨ AI æœåŠ¡
nohup python3 main.py > ai-service.log 2>&1 &

# æŸ¥çœ‹è¿›ç¨‹
ps aux | grep python3

# æŸ¥çœ‹æ—¥å¿—
tail -f ai-service.log
```

---

## âœ… éªŒè¯éƒ¨ç½²

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥åç«¯ï¼ˆåº”è¯¥è¿”å› 8081ï¼‰
netstat -tulnp | grep 8081

# æ£€æŸ¥ AI æœåŠ¡ï¼ˆåº”è¯¥è¿”å› 8001ï¼‰
netstat -tulnp | grep 8001

# æ£€æŸ¥ Nginxï¼ˆåº”è¯¥è¿”å› 80ï¼‰
netstat -tulnp | grep 80
```

### 2. æµ‹è¯•æ¥å£

```bash
# æµ‹è¯•åç«¯
curl http://localhost:8081/api/auth/health

# æµ‹è¯• AI æœåŠ¡
curl http://localhost:8001/health

# æµ‹è¯• Nginx ä»£ç†
curl http://localhost/api/auth/health
```

### 3. æµè§ˆå™¨è®¿é—®

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
```
http://æœåŠ¡å™¨IP
```

åº”è¯¥èƒ½çœ‹åˆ°å‰ç«¯é¡µé¢ï¼

---

## ğŸ“ æœåŠ¡å™¨ç›®å½•ç»“æ„

```
/opt/health-management/
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ dist/                          # å‰ç«¯é™æ€æ–‡ä»¶
â”‚       â”œâ”€â”€ index.html
â”‚       â””â”€â”€ assets/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ health-management-0.0.1-SNAPSHOT.jar   # åç«¯ jar åŒ…
â”‚   â”œâ”€â”€ application-prod.yml           # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ backend.log                    # åç«¯æ—¥å¿—
â”‚   â””â”€â”€ uploads/                       # ä¸Šä¼ æ–‡ä»¶ç›®å½•
â””â”€â”€ ai-service/
    â”œâ”€â”€ main.py
    â”œâ”€â”€ requirements.txt
    â”œâ”€â”€ ai-service.log                 # AI æ—¥å¿—
    â””â”€â”€ venv/                          # Python è™šæ‹Ÿç¯å¢ƒï¼ˆå¯é€‰ï¼‰
```

---

## ğŸ”„ æ›´æ–°ä»£ç 

### æ›´æ–°å‰ç«¯

```bash
# æœ¬åœ°é‡æ–°æ‰“åŒ…
cd /Users/liuzixuan/healthManagement/frontend
npm run build

# ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆä¼šè¦†ç›–æ—§æ–‡ä»¶ï¼‰
scp -r dist/* root@æœåŠ¡å™¨IP:/opt/health-management/frontend/dist/

# æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼Œåˆ·æ–°é¡µé¢å³å¯çœ‹åˆ°æ›´æ–°
```

### æ›´æ–°åç«¯

```bash
# æœ¬åœ°é‡æ–°æ‰“åŒ…
cd /Users/liuzixuan/healthManagement/backend
./mvnw clean package -DskipTests

# ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp target/health-management-0.0.1-SNAPSHOT.jar \
    root@æœåŠ¡å™¨IP:/opt/health-management/backend/

# åœ¨æœåŠ¡å™¨ä¸Šé‡å¯åç«¯
# 1. æ‰¾åˆ°è¿›ç¨‹ ID
ps aux | grep health-management

# 2. åœæ­¢æ—§è¿›ç¨‹
kill <PID>

# 3. å¯åŠ¨æ–°ç‰ˆæœ¬
cd /opt/health-management/backend
nohup java -jar health-management-0.0.1-SNAPSHOT.jar \
    --spring.profiles.active=prod \
    > backend.log 2>&1 &
```

---

## ğŸ›‘ åœæ­¢æœåŠ¡

```bash
# åœæ­¢åç«¯
ps aux | grep health-management
kill <åç«¯è¿›ç¨‹ID>

# åœæ­¢ AI æœåŠ¡
ps aux | grep "python3 main.py"
kill <AIè¿›ç¨‹ID>

# é‡å¯ Nginx
sudo systemctl restart nginx
```

---

## ğŸ“ å¿«é€Ÿå¯åœè„šæœ¬ï¼ˆå¯é€‰ï¼‰

åˆ›å»ºä¾¿æ·è„šæœ¬æ¥ç®¡ç†æœåŠ¡ï¼š

### å¯åŠ¨è„šæœ¬ `start-services.sh`

```bash
#!/bin/bash

cd /opt/health-management

# å¯åŠ¨åç«¯
cd backend
nohup java -jar health-management-0.0.1-SNAPSHOT.jar \
    --spring.profiles.active=prod \
    > backend.log 2>&1 &
echo "âœ… åç«¯å·²å¯åŠ¨"

# å¯åŠ¨ AI æœåŠ¡
cd ../ai-service
export DASHSCOPE_API_KEY="ä½ çš„APIå¯†é’¥"
nohup python3 main.py > ai-service.log 2>&1 &
echo "âœ… AI æœåŠ¡å·²å¯åŠ¨"

# æ˜¾ç¤ºè¿›ç¨‹
sleep 2
ps aux | grep -E "health-management|main.py" | grep -v grep
```

### åœæ­¢è„šæœ¬ `stop-services.sh`

```bash
#!/bin/bash

# åœæ­¢åç«¯
pkill -f health-management-0.0.1-SNAPSHOT.jar
echo "âœ… åç«¯å·²åœæ­¢"

# åœæ­¢ AI æœåŠ¡
pkill -f "python3 main.py"
echo "âœ… AI æœåŠ¡å·²åœæ­¢"
```

ä½¿ç”¨æ–¹å¼ï¼š

```bash
chmod +x start-services.sh stop-services.sh

# å¯åŠ¨
./start-services.sh

# åœæ­¢
./stop-services.sh
```

---

## ğŸ” å¸¸è§é—®é¢˜

### 1. å‰ç«¯é¡µé¢ç©ºç™½

```bash
# æ£€æŸ¥ dist ç›®å½•
ls -la /opt/health-management/frontend/dist/

# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t
sudo cat /etc/nginx/sites-available/health-management

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### 2. API è¯·æ±‚å¤±è´¥

```bash
# æ£€æŸ¥åç«¯æ˜¯å¦è¿è¡Œ
ps aux | grep java

# æ£€æŸ¥ç«¯å£
netstat -tulnp | grep 8081

# æŸ¥çœ‹åç«¯æ—¥å¿—
tail -f /opt/health-management/backend/backend.log

# æµ‹è¯•åç«¯ç›´æ¥è®¿é—®
curl http://localhost:8081/api/auth/health
```

### 3. è·¨åŸŸé—®é¢˜

å¦‚æœå‰ç«¯å’Œåç«¯ä¸åœ¨åŒä¸€åŸŸåï¼Œéœ€è¦åœ¨åç«¯é…ç½® CORSã€‚
åç«¯å·²é…ç½® CORSï¼Œå…è®¸æ‰€æœ‰æ¥æºï¼Œæ‰€ä»¥é€šå¸¸ä¸ä¼šæœ‰é—®é¢˜ã€‚

### 4. ç«¯å£è¢«å ç”¨

```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
sudo lsof -i :80
sudo lsof -i :8081
sudo lsof -i :8001

# åœæ­¢å ç”¨è¿›ç¨‹
sudo kill <PID>
```

---

## ğŸ”’ ç”Ÿäº§ç¯å¢ƒå»ºè®®

### 1. ä½¿ç”¨ç¯å¢ƒå˜é‡æ–‡ä»¶

åˆ›å»º `/opt/health-management/.env`ï¼š

```bash
DASHSCOPE_API_KEY=ä½ çš„APIå¯†é’¥
ALIYUN_OSS_ACCESS_KEY_ID=ä½ çš„OSSå¯†é’¥ID
ALIYUN_OSS_ACCESS_KEY_SECRET=ä½ çš„OSSå¯†é’¥Secret
```

å¯åŠ¨æ—¶åŠ è½½ï¼š

```bash
source /opt/health-management/.env
nohup java -jar health-management-0.0.1-SNAPSHOT.jar \
    --spring.profiles.active=prod \
    > backend.log 2>&1 &
```

### 2. é…ç½® HTTPS

```bash
# å®‰è£… Certbot
sudo apt-get install certbot python3-certbot-nginx

# ç”³è¯·è¯ä¹¦
sudo certbot --nginx -d your-domain.com
```

### 3. é˜²ç«å¢™é…ç½®

```bash
# Ubuntu
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

---

## ğŸ“Š éƒ¨ç½²æ£€æŸ¥æ¸…å•

æ„å»ºé˜¶æ®µï¼š
- [ ] å‰ç«¯æ‰“åŒ…å®Œæˆï¼Œç”Ÿæˆ `dist/` æ–‡ä»¶å¤¹
- [ ] åç«¯æ‰“åŒ…å®Œæˆï¼Œç”Ÿæˆ `.jar` æ–‡ä»¶

ä¸Šä¼ é˜¶æ®µï¼š
- [ ] `dist/` æ–‡ä»¶å¤¹å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] `.jar` æ–‡ä»¶å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] é…ç½®æ–‡ä»¶å·²ä¸Šä¼ 

é…ç½®é˜¶æ®µï¼š
- [ ] Nginx é…ç½®æ–‡ä»¶å·²åˆ›å»º
- [ ] Nginx é…ç½®æµ‹è¯•é€šè¿‡ (`nginx -t`)
- [ ] Nginx å·²é‡å¯

å¯åŠ¨é˜¶æ®µï¼š
- [ ] åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆç«¯å£ 8081ï¼‰
- [ ] AI æœåŠ¡å·²å¯åŠ¨ï¼ˆç«¯å£ 8001ï¼‰
- [ ] Nginx è¿è¡Œæ­£å¸¸ï¼ˆç«¯å£ 80ï¼‰

éªŒè¯é˜¶æ®µï¼š
- [ ] å¯ä»¥è®¿é—®å‰ç«¯é¡µé¢
- [ ] ç”¨æˆ·å¯ä»¥æ³¨å†Œç™»å½•
- [ ] API è¯·æ±‚æ­£å¸¸
- [ ] èŠå¤©åŠŸèƒ½æ­£å¸¸

---

## ğŸ‰ å®Œæˆï¼

ç°åœ¨ä½ çš„éƒ¨ç½²æ–¹å¼éå¸¸ç®€å•ï¼š

1. **æœ¬åœ°æ‰“åŒ…** â†’ `npm run build` + `mvn package`
2. **ä¸Šä¼ æ–‡ä»¶** â†’ `scp` ä¸Šä¼  dist å’Œ jar
3. **é…ç½® Nginx** â†’ æŒ‡å‘ distï¼Œä»£ç†åˆ°åç«¯
4. **å¯åŠ¨æœåŠ¡** â†’ `nohup java -jar` + `nohup python3 main.py`

è®¿é—® `http://æœåŠ¡å™¨IP` å³å¯ï¼




